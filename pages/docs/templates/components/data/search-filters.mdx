---
description: Production-ready search with filters, debounced input, URL state sync, and TanStack Query integration.
---

# Search with Filters

A complete search and filter system with debouncing, URL synchronization, and server-side filtering.

import { Callout, Tabs, Tab, Steps } from 'nextra/components'

## Overview

This template provides:
- Debounced search input
- Multiple filter types (select, multi-select, date range)
- URL state synchronization
- Filter reset functionality
- TanStack Query integration
- Loading and empty states

## Dependencies

```bash
npm install @tanstack/react-query nuqs
npx shadcn-ui@latest add input select button badge popover calendar
npm install date-fns  # for date formatting
```

## Code

<Tabs items={['SearchFilters.tsx', 'useFilters.ts', 'FilterBar.tsx', 'Usage']}>
  <Tab>
```tsx
import { useState, useEffect } from 'react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Search, X } from 'lucide-react';
import { useDebounce } from '@/hooks/useDebounce';

interface SearchInputProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  debounceMs?: number;
}

export function SearchInput({
  value,
  onChange,
  placeholder = 'Search...',
  debounceMs = 300,
}: SearchInputProps) {
  const [localValue, setLocalValue] = useState(value);
  const debouncedValue = useDebounce(localValue, debounceMs);

  // Sync external value changes
  useEffect(() => {
    setLocalValue(value);
  }, [value]);

  // Emit debounced changes
  useEffect(() => {
    if (debouncedValue !== value) {
      onChange(debouncedValue);
    }
  }, [debouncedValue, onChange, value]);

  return (
    <div className="relative">
      <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
      <Input
        value={localValue}
        onChange={(e) => setLocalValue(e.target.value)}
        placeholder={placeholder}
        className="pl-9 pr-9"
      />
      {localValue && (
        <button
          onClick={() => {
            setLocalValue('');
            onChange('');
          }}
          className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
        >
          <X className="h-4 w-4" />
        </button>
      )}
    </div>
  );
}
```
  </Tab>
  <Tab>
```tsx
import { useQueryStates, parseAsString, parseAsArrayOf, parseAsInteger } from 'nuqs';
import { useCallback, useMemo } from 'react';

export interface FilterState {
  search: string;
  status: string;
  categories: string[];
  page: number;
}

const filterParsers = {
  search: parseAsString.withDefault(''),
  status: parseAsString.withDefault(''),
  categories: parseAsArrayOf(parseAsString).withDefault([]),
  page: parseAsInteger.withDefault(1),
};

export function useFilters() {
  const [filters, setFilters] = useQueryStates(filterParsers, {
    history: 'push',
  });

  const updateFilter = useCallback(
    <K extends keyof FilterState>(key: K, value: FilterState[K]) => {
      setFilters({ [key]: value, page: 1 }); // Reset page on filter change
    },
    [setFilters]
  );

  const resetFilters = useCallback(() => {
    setFilters({
      search: '',
      status: '',
      categories: [],
      page: 1,
    });
  }, [setFilters]);

  const hasActiveFilters = useMemo(() => {
    return (
      filters.search !== '' ||
      filters.status !== '' ||
      filters.categories.length > 0
    );
  }, [filters]);

  return {
    filters,
    updateFilter,
    resetFilters,
    hasActiveFilters,
    setPage: (page: number) => setFilters({ page }),
  };
}
```
  </Tab>
  <Tab>
```tsx
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover';
import { Checkbox } from '@/components/ui/checkbox';
import { X, Filter } from 'lucide-react';
import { SearchInput } from './SearchInput';
import { useFilters } from './useFilters';

const STATUS_OPTIONS = [
  { value: 'active', label: 'Active' },
  { value: 'inactive', label: 'Inactive' },
  { value: 'pending', label: 'Pending' },
];

const CATEGORY_OPTIONS = [
  { value: 'electronics', label: 'Electronics' },
  { value: 'clothing', label: 'Clothing' },
  { value: 'books', label: 'Books' },
  { value: 'home', label: 'Home & Garden' },
];

export function FilterBar() {
  const { filters, updateFilter, resetFilters, hasActiveFilters } = useFilters();

  return (
    <div className="space-y-4">
      <div className="flex flex-wrap items-center gap-3">
        {/* Search */}
        <div className="w-full sm:w-64">
          <SearchInput
            value={filters.search}
            onChange={(value) => updateFilter('search', value)}
            placeholder="Search products..."
          />
        </div>

        {/* Status Filter */}
        <Select
          value={filters.status || 'all'}
          onValueChange={(value) => updateFilter('status', value === 'all' ? '' : value)}
        >
          <SelectTrigger className="w-[140px]">
            <SelectValue placeholder="Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Status</SelectItem>
            {STATUS_OPTIONS.map((option) => (
              <SelectItem key={option.value} value={option.value}>
                {option.label}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>

        {/* Category Multi-Select */}
        <Popover>
          <PopoverTrigger asChild>
            <Button variant="outline" className="min-w-[140px]">
              <Filter className="mr-2 h-4 w-4" />
              Categories
              {filters.categories.length > 0 && (
                <Badge variant="secondary" className="ml-2">
                  {filters.categories.length}
                </Badge>
              )}
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-56" align="start">
            <div className="space-y-2">
              {CATEGORY_OPTIONS.map((option) => (
                <label
                  key={option.value}
                  className="flex cursor-pointer items-center gap-2"
                >
                  <Checkbox
                    checked={filters.categories.includes(option.value)}
                    onCheckedChange={(checked) => {
                      const newCategories = checked
                        ? [...filters.categories, option.value]
                        : filters.categories.filter((c) => c !== option.value);
                      updateFilter('categories', newCategories);
                    }}
                  />
                  <span className="text-sm">{option.label}</span>
                </label>
              ))}
            </div>
          </PopoverContent>
        </Popover>

        {/* Reset Button */}
        {hasActiveFilters && (
          <Button variant="ghost" size="sm" onClick={resetFilters}>
            <X className="mr-1 h-4 w-4" />
            Clear filters
          </Button>
        )}
      </div>

      {/* Active Filter Tags */}
      {hasActiveFilters && (
        <div className="flex flex-wrap gap-2">
          {filters.search && (
            <Badge variant="secondary" className="gap-1">
              Search: {filters.search}
              <button onClick={() => updateFilter('search', '')}>
                <X className="h-3 w-3" />
              </button>
            </Badge>
          )}
          {filters.status && (
            <Badge variant="secondary" className="gap-1">
              Status: {filters.status}
              <button onClick={() => updateFilter('status', '')}>
                <X className="h-3 w-3" />
              </button>
            </Badge>
          )}
          {filters.categories.map((category) => (
            <Badge key={category} variant="secondary" className="gap-1">
              {category}
              <button
                onClick={() =>
                  updateFilter(
                    'categories',
                    filters.categories.filter((c) => c !== category)
                  )
                }
              >
                <X className="h-3 w-3" />
              </button>
            </Badge>
          ))}
        </div>
      )}
    </div>
  );
}
```
  </Tab>
  <Tab>
```tsx
// pages/products.tsx
import { useQuery } from '@tanstack/react-query';
import { FilterBar } from '@/components/FilterBar';
import { ProductList } from '@/components/ProductList';
import { Pagination } from '@/components/Pagination';
import { useFilters } from '@/hooks/useFilters';

export default function ProductsPage() {
  const { filters, setPage } = useFilters();

  const { data, isLoading } = useQuery({
    queryKey: ['products', filters],
    queryFn: () => fetchProducts(filters),
  });

  return (
    <div className="container py-8">
      <h1 className="mb-6 text-3xl font-bold">Products</h1>

      <FilterBar />

      <div className="mt-6">
        {isLoading ? (
          <div className="flex h-64 items-center justify-center">
            <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
          </div>
        ) : data?.items.length === 0 ? (
          <div className="flex h-64 flex-col items-center justify-center text-muted-foreground">
            <p>No products found</p>
            <p className="text-sm">Try adjusting your filters</p>
          </div>
        ) : (
          <>
            <ProductList products={data?.items ?? []} />
            <Pagination
              currentPage={filters.page}
              totalPages={data?.totalPages ?? 1}
              onPageChange={setPage}
            />
          </>
        )}
      </div>
    </div>
  );
}

// API function
async function fetchProducts(filters: FilterState) {
  const params = new URLSearchParams();
  if (filters.search) params.set('search', filters.search);
  if (filters.status) params.set('status', filters.status);
  if (filters.categories.length) {
    params.set('categories', filters.categories.join(','));
  }
  params.set('page', String(filters.page));

  const response = await fetch(`/api/products?${params}`);
  return response.json();
}
```
  </Tab>
</Tabs>

## useDebounce Hook

```tsx
// hooks/useDebounce.ts
import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => clearTimeout(timer);
  }, [value, delay]);

  return debouncedValue;
}
```

## Features

### URL State Synchronization

Filters are automatically synced to URL query parameters using `nuqs`:
- Shareable URLs with active filters
- Browser back/forward navigation works
- Page refreshes preserve filters

### Filter Types

| Type | Component | Use Case |
|------|-----------|----------|
| Search | Debounced input | Text search |
| Single Select | Select dropdown | Enum values |
| Multi-Select | Checkbox popover | Multiple categories |
| Date Range | Calendar popover | Date filtering |

### Performance

- Debounced search prevents excessive API calls
- Query key includes all filters for proper caching
- `placeholderData` keeps previous results during loading

## Date Range Filter

Add date range filtering:

```tsx
import { Calendar } from '@/components/ui/calendar';
import { format } from 'date-fns';
import { parseAsIsoDateTime } from 'nuqs';

// In filterParsers
const filterParsers = {
  // ... other parsers
  startDate: parseAsIsoDateTime,
  endDate: parseAsIsoDateTime,
};

// Date Range Picker Component
function DateRangePicker({ startDate, endDate, onChange }) {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline">
          {startDate && endDate
            ? `${format(startDate, 'MMM d')} - ${format(endDate, 'MMM d')}`
            : 'Select dates'}
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-auto p-0" align="start">
        <Calendar
          mode="range"
          selected={{ from: startDate, to: endDate }}
          onSelect={(range) => onChange(range?.from, range?.to)}
        />
      </PopoverContent>
    </Popover>
  );
}
```

## Related

- [Data Table](/docs/templates/components/data/data-table) - Table with sorting and pagination
- [Infinite List](/docs/templates/components/data/infinite-list) - Infinite scroll pattern
